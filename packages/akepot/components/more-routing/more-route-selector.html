<link rel=import href="../../../../packages/polymer/polymer.html"><link rel=import href="more-route.html"><polymer-element name=more-route-selector><script>Polymer("more-route-selector",{publish:{routes:[],multi:false,selectedIndex:-1,selectedRoute:null,selectedPath:null,selectedParams:{}},ready:function(){if(this.routes.length>0&&this.children.length>0){throw new Error('more-route-selector supports either routes="..." or child elements, not both')}},attached:function(){this.parent=this._findParent();this.async(function(){this._buildRoutes();this._observeRoutes();this.evaluate()})},evaluate:function(){var k=-1;var h=this.selectedIndex;for(var e=0,j;j=this._routeRefs[e];e++){if(j.active){k=e;break}}if(k===h){return}var b=this.selectedRoute;var a=this.selectedPath;var d=this.selectedParams;var c=this._routeRefs[k];var g=c?c.path:null;var f=c?c.params:{};this.selectedRoute=c;this.selectedIndex=k;this.selectedPath=g;this.selectedParams=f;this.fire("more-route-change",{newRoute:c,oldRoute:b,newIndex:k,oldIndex:h,newPath:g,oldPath:a,newParams:f,oldParams:d})},_buildRoutes:function(){if(this.routes.length>0){this._routeRefs=this._routesFromAttributes()}else{this._routeRefs=this._routesFromChildren()}},_routesFromAttributes:function(){var a=this.parent&&this.parent.path||"";return this.routes.map(function(b){if(MoreRouting.isPath(b)){return MoreRouting.getRouteByPath(a+b)}else{return MoreRouting.getRouteByName(b)}})},_routesFromChildren:function(){var a=[];for(var b=0,c;c=this.children[b];b++){a.push(c.route)}return a},_observeRoutes:function(){if(this._observer){this._observer.close()}this._observer=new CompoundObserver();for(var b=0,a;a=this._routeRefs[b];b++){this._observer.addPath(a,"active")}this._observer.open(this.evaluate.bind(this))},_findParent:function(){var b=this;while(b){b=b.parentNode||b.host;var a=b&&b.moreRouteContext||b;if(a instanceof this.constructor&&a!==this){return a}}return null}});</script></polymer-element>