<link rel=import href="core-xhr.html"><polymer-element name=core-ajax hidden attributes="url handleAs auto params response error method headers body contentType withCredentials progress loading"><script>Polymer("core-ajax",{url:"",handleAs:"",auto:false,params:"",response:null,error:null,loading:false,progress:null,method:"",headers:null,body:null,contentType:"application/x-www-form-urlencoded",withCredentials:false,xhrArgs:null,created:function(){this.progress={}},ready:function(){this.xhr=document.createElement("core-xhr")},receive:function(a,b){if(this.isSuccess(b)){this.processResponse(b)}else{this.processError(b)}this.complete(b)},isSuccess:function(b){var a=b.status||0;return !a||(a>=200&&a<300)},processResponse:function(b){var a=this.evalResponse(b);if(b===this.activeRequest){this.response=a}this.fire("core-response",{response:a,xhr:b})},processError:function(b){var a=b.status+": "+b.responseText;if(b===this.activeRequest){this.error=a}this.fire("core-error",{response:a,xhr:b})},processProgress:function(b,c){if(c!==this.activeRequest){return}var a={lengthComputable:b.lengthComputable,loaded:b.loaded,total:b.total};this.progress=a},complete:function(a){if(a===this.activeRequest){this.loading=false}this.fire("core-complete",{response:a.status,xhr:a})},evalResponse:function(a){return this[(this.handleAs||"text")+"Handler"](a)},xmlHandler:function(a){return a.responseXML},textHandler:function(a){return a.responseText},jsonHandler:function(c){var b=c.responseText;try{return JSON.parse(b)}catch(a){console.warn("core-ajax caught an exception trying to parse response as JSON:");console.warn("url:",this.url);console.warn(a);return b}},documentHandler:function(a){return a.response},blobHandler:function(a){return a.response},arraybufferHandler:function(a){return a.response},urlChanged:function(){if(!this.handleAs){var a=String(this.url).split(".").pop();switch(a){case"json":this.handleAs="json";break}}this.autoGo()},paramsChanged:function(){this.autoGo()},bodyChanged:function(){this.autoGo()},autoChanged:function(){this.autoGo()},autoGo:function(){if(this.auto){this.goJob=this.job(this.goJob,this.go,0)}},go:function(){var b=this.xhrArgs||{};b.body=this.body||b.body;b.params=this.params||b.params;if(b.params&&typeof(b.params)=="string"){b.params=JSON.parse(b.params)}b.headers=this.headers||b.headers||{};if(b.headers&&typeof(b.headers)=="string"){b.headers=JSON.parse(b.headers)}var a=Object.keys(b.headers).some(function(d){return d.toLowerCase()==="content-type"});if(!a&&this.contentType){b.headers["Content-Type"]=this.contentType}if(this.handleAs==="arraybuffer"||this.handleAs==="blob"||this.handleAs==="document"){b.responseType=this.handleAs}b.withCredentials=this.withCredentials;b.callback=this.receive.bind(this);b.url=this.url;b.method=this.method;this.response=this.error=this.progress=null;this.activeRequest=b.url&&this.xhr.request(b);if(this.activeRequest){this.loading=true;var c=this.activeRequest;if("onprogress" in c){this.activeRequest.addEventListener("progress",function(d){this.processProgress(d,c)}.bind(this),false)}else{this.progress={lengthComputable:false}}}return this.activeRequest}});</script></polymer-element>