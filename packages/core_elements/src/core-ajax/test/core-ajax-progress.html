<!doctype html><html><head><title>core-ajax</title><script src="../../webcomponentsjs/webcomponents.js"></script><script src="../../web-component-tester/browser.js"></script><link rel=import href="../core-ajax.html"></head><body><core-ajax handleAs=json auto></core-ajax><script>test("progress",function(b){var d=document.querySelector("core-ajax");var f=sinon.useFakeXMLHttpRequest();var e={"Content-Type":"text/json"};var a='{"content": "plentiful"}';var g=this.requests=[];f.onCreate=function(h){g.push(h);h.onprogress=null};var c=function(h,j,k){var i=new ProgressEvent("progress",{lengthComputable:h,loaded:j,total:k});return i};async.series([function(h){d.url="http://example.org/downloadLargeFile";h()},flush,animationFrameFlush,function(h){g[0].dispatchEvent(c(true,10,100));h()},flush,animationFrameFlush,function(h){assert(d.loading===true,"Request partially complete, but loading property was false.");var i=d.progress;assert(i.lengthComputable,"Progress should be computable");assert(i.loaded==10,"Expected 10 bytes loaded, got "+i.loaded);assert(i.total==100,"Expected 100 bytes total, got "+i.total);h()},animationFrameFlush,function(h){g[0].dispatchEvent(c(true,100,100));h()},animationFrameFlush,function(h){assert(d.loading===true,"Request partially complete, but loading property was false.");var i=d.progress;assert(i.lengthComputable,"Progress should be computable");assert(i.loaded==100,"Expected 10 bytes loaded, got "+i.loaded);assert(i.total==100,"Expected 100 bytes total, got "+i.total);h()},function(h){g[0].respond(200,e,a);h()},animationFrameFlush,function(h){assert(d.loading===false,"Request complete, but loading property was true.");assert(d.response.content==="plentiful","response not parsed");h()}],b)});</script></body></html>