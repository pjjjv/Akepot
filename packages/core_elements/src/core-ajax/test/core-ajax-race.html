<!doctype html><html><head><title>core-ajax</title><script src="../../webcomponentsjs/webcomponents.js"></script><script src="../../web-component-tester/browser.js"></script><link rel=import href="../core-ajax.html"></head><body><core-ajax handleAs=json auto></core-ajax><script>test("race-condition",function(b){var c=document.querySelector("core-ajax");var e=sinon.useFakeXMLHttpRequest();var d={"Content-Type":"text/json"};var a=function(g){return'{"url": "'+g+'"}'};var f=[];e.onCreate=function(g){f.push(g)};async.series([function(g){c.url="http://example.org/request1";g()},animationFrameFlush,function(g){c.url="http://example.org/request2";g()},animationFrameFlush,function(g){f[0].respond(200,d,a("http://example.org/request2"));g()},flush,function(g){f[1].respond(200,d,a("http://example.org/request1"));g()},flush,function(g){assert(c.response.url.match("request1"),"Race condition detected. An earlier request's delayed response caused the more recent request's response to be overwritten.");b();g()}],function(){})});</script></body></html>