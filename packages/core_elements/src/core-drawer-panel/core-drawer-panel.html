<link rel=import href="../core-media-query/core-media-query.html"><link rel=import href="../core-selector/core-selector.html"><polymer-element name=core-drawer-panel touch-action=auto><template><link rel=stylesheet href="core-drawer-panel.css"><core-media-query query="max-width: {{forceNarrow ? '' : responsiveWidth}}" queryMatches="{{queryMatches}}"></core-media-query><core-selector class="{{ {'narrow-layout' : narrow, transition : transition, dragging : dragging, 'right-drawer': rightDrawer} | tokenList }}" valueattr=id selected"{{selected}}"><div id=main _style="left: {{ narrow || rightDrawer ? '0' : drawerWidth }}; right: {{ rightDrawer ? (narrow ? '' : drawerWidth) : '' }};"><content select="[main]"></content><div id=scrim on-tap="{{togglePanel}}"></div></div><div id=drawer _style="width: {{ drawerWidth }}"><content select="[drawer]"></content></div></core-selector></template><script>Polymer("core-drawer-panel",{publish:{drawerWidth:"256px",responsiveWidth:"640px",selected:{value:null,reflect:true},defaultSelected:"main",narrow:{value:false,reflect:true},rightDrawer:false,disableSwipe:false,forceNarrow:false},eventDelegates:{trackstart:"trackStart",trackx:"trackx",trackend:"trackEnd",down:"downHandler",up:"upHandler",tap:"tapHandler"},transition:false,edgeSwipeSensitivity:15,peeking:false,dragging:false,hasTransform:true,hasWillChange:true,toggleAttribute:"core-drawer-toggle",created:function(){this.hasTransform="transform" in this.style;this.hasWillChange="willChange" in this.style},domReady:function(){this.async(function(){this.transition=true})},togglePanel:function(){this.selected=this.isMainSelected()?"drawer":"main"},openDrawer:function(){this.selected="drawer"},closeDrawer:function(){this.selected="main"},queryMatchesChanged:function(){this.narrow=this.queryMatches||this.forceNarrow;if(this.narrow){this.selected=this.defaultSelected}this.setAttribute("touch-action",this.swipeAllowed()?"pan-y":"");this.fire("core-responsive-change",{narrow:this.narrow})},forceNarrowChanged:function(){this.queryMatchesChanged()},swipeAllowed:function(){return this.narrow&&!this.disableSwipe},isMainSelected:function(){return this.selected==="main"},startEdgePeek:function(){this.width=this.$.drawer.offsetWidth;this.moveDrawer(this.translateXForDeltaX(this.rightDrawer?-this.edgeSwipeSensitivity:this.edgeSwipeSensitivity));this.peeking=true},stopEdgePeak:function(){if(this.peeking){this.peeking=false;this.moveDrawer(null)}},downHandler:function(a){if(!this.dragging&&this.isMainSelected()&&this.isEdgeTouch(a)){this.startEdgePeek()}},upHandler:function(a){this.stopEdgePeak()},tapHandler:function(a){if(a.target&&this.toggleAttribute&&a.target.hasAttribute(this.toggleAttribute)){this.togglePanel()}},isEdgeTouch:function(a){return this.swipeAllowed()&&(this.rightDrawer?a.pageX>=this.offsetWidth-this.edgeSwipeSensitivity:a.pageX<=this.edgeSwipeSensitivity)},trackStart:function(a){if(this.swipeAllowed()){this.dragging=true;if(this.isMainSelected()){this.dragging=this.peeking||this.isEdgeTouch(a)}if(this.dragging){this.width=this.$.drawer.offsetWidth;this.transition=false;a.preventTap()}}},translateXForDeltaX:function(b){var a=this.isMainSelected();if(this.rightDrawer){return Math.max(0,a?this.width+b:b)}else{return Math.min(0,a?b-this.width:b)}},trackx:function(a){if(this.dragging){if(this.peeking){if(Math.abs(a.dx)<=this.edgeSwipeSensitivity){return}this.peeking=false}this.moveDrawer(this.translateXForDeltaX(a.dx))}},trackEnd:function(a){if(this.dragging){this.dragging=false;this.transition=true;this.moveDrawer(null);if(this.rightDrawer){this.selected=a.xDirection>0?"main":"drawer"}else{this.selected=a.xDirection>0?"drawer":"main"}}},transformForTranslateX:function(a){if(a===null){return""}return this.hasWillChange?"translateX("+a+"px)":"translate3d("+a+"px, 0, 0)"},moveDrawer:function(b){var a=this.$.drawer.style;if(this.hasTransform){a.transform=this.transformForTranslateX(b)}else{a.webkitTransform=this.transformForTranslateX(b)}}});</script></polymer-element>