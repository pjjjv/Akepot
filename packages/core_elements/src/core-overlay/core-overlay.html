<link rel=import href="../polymer/polymer.html"><link rel=import href="../core-transition/core-transition.html"><link rel=import href="core-key-helper.html"><link rel=import href="core-overlay-layer.html"><style>.core-overlay-backdrop{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:black;opacity:0;transition:opacity .2s}.core-overlay-backdrop.core-opened{opacity:.6}</style><polymer-element name=core-overlay><script>(function(){Polymer("core-overlay",{publish:{target:null,sizingTarget:null,opened:false,backdrop:false,layered:false,autoCloseDisabled:false,autoFocusDisabled:false,closeAttribute:"core-overlay-toggle",closeSelector:"",transition:"core-transition-fade"},captureEventName:"tap",targetListeners:{tap:"tapHandler",keydown:"keydownHandler","core-transitionend":"transitionend"},registerCallback:function(m){this.layer=document.createElement("core-overlay-layer");this.keyHelper=document.createElement("core-key-helper");this.meta=document.createElement("core-transition");this.scrim=document.createElement("div");this.scrim.className="core-overlay-backdrop"},ready:function(){this.target=this.target||this;Polymer.flush()},toggle:function(){this.opened=!this.opened},open:function(){this.opened=true},close:function(){this.opened=false},domReady:function(){this.ensureTargetSetup()},targetChanged:function(m){if(this.target){if(this.target.tabIndex<0){this.target.tabIndex=-1}this.addElementListenerList(this.target,this.targetListeners);this.target.style.display="none";this.target.__overlaySetup=false}if(m){this.removeElementListenerList(m,this.targetListeners);var n=this.getTransition();if(n){n.teardown(m)}else{m.style.position="";m.style.outline=""}m.style.display=""}},transitionChanged:function(m){if(!this.target){return}if(m){this.getTransition(m).teardown(this.target)}this.target.__overlaySetup=false},ensureTargetSetup:function(){if(!this.target||this.target.__overlaySetup){return}if(!this.sizingTarget){this.sizingTarget=this.target}this.target.__overlaySetup=true;this.target.style.display="";var o=this.getTransition();if(o){o.setup(this.target)}var m=this.target.style;var n=getComputedStyle(this.target);if(n.position==="static"){m.position="fixed"}m.outline="none";m.display="none"},openedChanged:function(){this.transitioning=true;this.ensureTargetSetup();this.prepareRenderOpened();this.async(function(){this.target.style.display="";this.target.offsetWidth;this.renderOpened()});this.fire("core-overlay-open",this.opened)},prepareRenderOpened:function(){if(this.opened){c(this)}this.prepareBackdrop();this.async(function(){if(!this.autoCloseDisabled){this.enableElementListener(this.opened,document,this.captureEventName,"captureHandler",true)}});this.enableElementListener(this.opened,window,"resize","resizeHandler");if(this.opened){this.target.offsetHeight;this.discoverDimensions();this.preparePositioning();this.positionTarget();this.updateTargetDimensions();this.finishPositioning();if(this.layered){this.layer.addElement(this.target);this.layer.opened=this.opened}}},renderOpened:function(){var m=this.getTransition();if(m){m.go(this.target,{opened:this.opened})}else{this.transitionend()}this.renderBackdropOpened()},transitionend:function(m){if(m&&m.target!==this.target){return}this.transitioning=false;if(!this.opened){this.resetTargetDimensions();this.target.style.display="none";this.completeBackdrop();l(this);if(this.layered){if(!e()){this.layer.opened=this.opened}this.layer.removeElement(this.target)}}this.fire("core-overlay-"+(this.opened?"open":"close")+"-completed");this.applyFocus()},prepareBackdrop:function(){if(this.backdrop&&this.opened){if(!this.scrim.parentNode){document.body.appendChild(this.scrim);this.scrim.style.zIndex=i()-1}h(this)}},renderBackdropOpened:function(){if(this.backdrop&&g().length<2){this.scrim.classList.toggle("core-opened",this.opened)}},completeBackdrop:function(){if(this.backdrop){h(this);if(g().length===0){this.scrim.parentNode.removeChild(this.scrim)}}},preparePositioning:function(){this.target.style.transition=this.target.style.webkitTransition="none";this.target.style.transform=this.target.style.webkitTransform="none";this.target.style.display=""},discoverDimensions:function(){if(this.dimensions){return}var n=getComputedStyle(this.target);var m=getComputedStyle(this.sizingTarget);this.dimensions={position:{v:n.top!=="auto"?"top":(n.bottom!=="auto"?"bottom":null),h:n.left!=="auto"?"left":(n.right!=="auto"?"right":null),css:n.position},size:{v:m.maxHeight!=="none",h:m.maxWidth!=="none"},margin:{top:parseInt(n.marginTop)||0,right:parseInt(n.marginRight)||0,bottom:parseInt(n.marginBottom)||0,left:parseInt(n.marginLeft)||0}}},finishPositioning:function(m){this.target.style.display="none";this.target.style.transform=this.target.style.webkitTransform="";this.target.offsetWidth;this.target.style.transition=this.target.style.webkitTransition=""},getTransition:function(m){return this.meta.byId(m||this.transition)},getFocusNode:function(){return this.target.querySelector("[autofocus]")||this.target},applyFocus:function(){var m=this.getFocusNode();if(this.opened){if(!this.autoFocusDisabled){m.focus()}}else{m.blur();if(e()==this){console.warn("Current core-overlay is attempting to focus itself as next! (bug)")}else{j()}}},positionTarget:function(){this.fire("core-overlay-position",{target:this.target,sizingTarget:this.sizingTarget,opened:this.opened});if(!this.dimensions.position.v){this.target.style.top="0px"}if(!this.dimensions.position.h){this.target.style.left="0px"}},updateTargetDimensions:function(){this.sizeTarget();this.repositionTarget()},sizeTarget:function(){this.sizingTarget.style.boxSizing="border-box";var n=this.dimensions;var m=this.target.getBoundingClientRect();if(!n.size.v){this.sizeDimension(m,n.position.v,"top","bottom","Height")}if(!n.size.h){this.sizeDimension(m,n.position.h,"left","right","Width")}},sizeDimension:function(x,w,n,s,z){var y=this.dimensions;var u=(w===s);var r=u?n:s;var v=window["inner"+z];var p=y.margin[r]+(u?v-x[s]:x[n]);var t="offset"+z;var q=this.target[t]-this.sizingTarget[t];this.sizingTarget.style["max"+z]=(v-p-q)+"px"},repositionTarget:function(){if(this.dimensions.position.css!=="fixed"){return}if(!this.dimensions.position.v){var n=(window.innerHeight-this.target.offsetHeight)/2;n-=this.dimensions.margin.top;this.target.style.top=n+"px"}if(!this.dimensions.position.h){var m=(window.innerWidth-this.target.offsetWidth)/2;m-=this.dimensions.margin.left;this.target.style.left=m+"px"}},resetTargetDimensions:function(){if(!this.dimensions||!this.dimensions.size.v){this.sizingTarget.style.maxHeight="";this.target.style.top=""}if(!this.dimensions||!this.dimensions.size.h){this.sizingTarget.style.maxWidth="";this.target.style.left=""}this.dimensions=null},tapHandler:function(m){if(m.target&&(this.closeSelector&&m.target.matches(this.closeSelector))||(this.closeAttribute&&m.target.hasAttribute(this.closeAttribute))){this.toggle()}else{if(this.autoCloseJob){this.autoCloseJob.stop();this.autoCloseJob=null}}},captureHandler:function(m){if(!this.autoCloseDisabled&&(e()==this)){this.autoCloseJob=this.job(this.autoCloseJob,function(){this.close()})}},keydownHandler:function(m){if(!this.autoCloseDisabled&&(m.keyCode==this.keyHelper.ESCAPE_KEY)){this.close();m.stopPropagation()}},resizeHandler:function(){this.updateTargetDimensions()},addElementListenerList:function(o,n){for(var m in n){this.addElementListener(o,m,n[m])}},removeElementListenerList:function(o,n){for(var m in n){this.removeElementListener(o,m,n[m])}},enableElementListener:function(o,q,p,n,m){if(o){this.addElementListener(q,p,n,m)}else{this.removeElementListener(q,p,n,m)}},addElementListener:function(q,p,n,m){var o=this._makeBoundListener(n);if(q&&o){Polymer.addEventListener(q,p,o,m)}},removeElementListener:function(q,p,n,m){var o=this._makeBoundListener(n);if(q&&o){Polymer.removeEventListener(q,p,o,m)}},_makeBoundListener:function(n){var m=this,p=this[n];if(!p){return}var o="_bound"+n;if(!this[o]){this[o]=function(q){p.call(m,q)}}return this[o]}});var a=[];function c(m){var o=i();a.push(m);var n=i();if(n<=o){d(m,o)}}function l(m){var n=a.indexOf(m);if(n>=0){a.splice(n,1);f(m,"")}}function d(m,n){f(m.target,n+2)}function f(m,n){m.style.zIndex=n}function e(){return a[a.length-1]}var k=10;function i(){var o;var n=e();if(n){var m=window.getComputedStyle(n.target).zIndex;if(!isNaN(m)){o=Number(m)}}return o||k}function j(){var m=e();if(m&&!m.transitioning){m.applyFocus()}}var b=[];function h(n){if(n.opened){b.push(n)}else{var m=b.indexOf(n);if(m>=0){b.splice(m,1)}}}function g(){return b}})();</script></polymer-element>