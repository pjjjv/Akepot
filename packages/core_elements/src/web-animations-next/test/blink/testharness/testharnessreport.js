var metadata_generator={currentMetadata:{},cachedMetadata:!1,metadataProperties:["help","assert","author"],error:function(e){var t=document.createElement("p");t.setAttribute("class","error"),this.appendText(t,e);var a=document.getElementById("summary");a?a.parentNode.insertBefore(t,a):document.body.appendChild(t)},validateContact:function(e,t){for(var a=!0,r=e.properties[t],n=Array.isArray(r)?r:[r],i=0;i<n.length;i++){r=n[i];var s=/(\S+)(\s*)<(.*)>(.*)/;s.test(r)||(s=/(\S+)(\s+)(http[s]?:\/\/)(.*)/,s.test(r)||(this.error('Metadata property "'+t+'" for test: "'+e.name+'" must have name and contact information ("name <email>" or "name http(s)://")'),a=!1))}return a},extractFromTest:function(e){for(var t={},a=0;a<this.metadataProperties.length;a++){var r=this.metadataProperties[a];e.properties.hasOwnProperty(r)&&("author"==r&&this.validateContact(e,r),t[r]=e.properties[r])}return t},validateCache:function(){for(var e in this.currentMetadata){if(!this.cachedMetadata.hasOwnProperty(e))return!1;var t=this.currentMetadata[e],a=this.cachedMetadata[e];delete this.cachedMetadata[e];for(var r=0;r<this.metadataProperties.length;r++){var n=this.metadataProperties[r];if(a.hasOwnProperty(n)&&t.hasOwnProperty(n))if(Array.isArray(a[n])){if(!Array.isArray(t[n]))return!1;if(a[n].length!=t[n].length)return!1;for(var i=0;i<a[n].length;i++)if(a[n][i]!=t[n][i])return!1}else{if(Array.isArray(t[n]))return!1;if(a[n]!=t[n])return!1}else if(a.hasOwnProperty(n)||t.hasOwnProperty(n))return!1}}for(var e in this.cachedMetadata)return!1;return!0},appendText:function(e,t){e.appendChild(document.createTextNode(t))},jsonifyArray:function(e,t){var a="[";if(1==e.length)a+=JSON.stringify(e[0]);else for(var r=0;r<e.length;r++)r>0&&(a+=",\n  "+t),a+=JSON.stringify(e[r]);return a+="]"},jsonifyObject:function(e,t){var a,r="{",n=0;for(var i in e)++n,(Array.isArray(e[i])||"object"==typeof a)&&++n;if(1==n)for(var i in e)r+=' "'+i+'": '+JSON.stringify(e[i])+" ";else{var s=!0;for(var i in e)s||(r+=","),s=!1,r+="\n  "+t+'"'+i+'": ',a=e[i],r+=Array.isArray(a)?this.jsonifyArray(a,t+"                ".substr(0,5+i.length)):"object"==typeof a?this.jsonifyObject(a,t+"  "):JSON.stringify(a);1<r.length&&(r+="\n"+t)}return r+="}"},generateSource:function(){var e='<script id="metadata_cache">/*\n'+this.jsonifyObject(this.currentMetadata,"")+"\n*/</script>\n";return e},addSourceElement:function(e){var t=document.createElement("div");t.setAttribute("id","metadata_source");var a=document.createElement("p");this.cachedMetadata?this.appendText(a,'Replace the existing <script id="metadata_cache"> element in the test\'s <head> with the following:'):this.appendText(a,"Copy the following into the <head> element of the test or the test's metadata sidecar file:"),t.appendChild(a);var r=document.createElement("pre");this.appendText(r,this.generateSource()),t.appendChild(r);var n=document.getElementById("metadata_issue");n.parentNode.insertBefore(t,n.nextSibling),n.parentNode.removeChild(n),e.preventDefault?e.preventDefault():e.returnValue=!1},getCachedMetadata:function(){var e=document.getElementById("metadata_cache");if(e){var t=e.firstChild.nodeValue,a=t.indexOf("{"),r=t.lastIndexOf("}");if(a>-1&&r>-1){t=t.slice(a,r+1);try{this.cachedMetadata=JSON.parse(t)}catch(e){this.cachedMetadata="Invalid JSON in Cached metadata. "}}else this.cachedMetadata="Metadata not found in cache element. "}},process:function(e){for(var t=0;t<e.length;t++){var a=e[t];this.currentMetadata.hasOwnProperty(a.name)?this.error("Duplicate test name: "+a.name):this.currentMetadata[a.name]=this.extractFromTest(a)}this.getCachedMetadata();var r=null,n="warning",i=!1;if(0===e.length)this.cachedMetadata&&(r="Cached metadata present but no tests. ");else if(1===e.length)if(this.cachedMetadata)r="Single test files should not have cached metadata. ";else{var s=this.currentMetadata[e[0].name];for(var d in s)if(s.hasOwnProperty(d)){r="Single tests should not have metadata. Move metadata to <head>. ";break}}else this.cachedMetadata&&(n="error","string"==typeof this.cachedMetadata?(r=this.cachedMetadata,i=!0):this.validateCache()||(r="Cached metadata out of sync. ",i=!0));if(r){var o=document.createElement("p");if(o.setAttribute("id","metadata_issue"),o.setAttribute("class",n),this.appendText(o,r),i){var c=document.createElement("a");this.appendText(c,"Click for source code."),c.setAttribute("href","#"),c.setAttribute("onclick","metadata_generator.addSourceElement(event)"),o.appendChild(c)}var h=document.getElementById("summary");if(h)h.parentNode.insertBefore(o,h);else{var p=document.getElementById("log");p&&p.appendChild(o)}}},setup:function(){add_completion_callback(function(e,t){metadata_generator.process(e,t)})}},url=document.URL,path=url.slice(0,url.lastIndexOf("/"));document.write(-1!=path.slice(-13).indexOf("interpolation")?'<script src="../../../web-animations-next.dev.js"></script>':'<script src="../../web-animations-next.dev.js"></script>'),window.parent&&parent.window.initTestHarness?parent.window.initTestHarness(window):metadata_generator.setup();try{window.opener&&"testharness_properties"in window.opener&&setup(JSON.parse(JSON.stringify(window.opener.testharness_properties)))}catch(e){}