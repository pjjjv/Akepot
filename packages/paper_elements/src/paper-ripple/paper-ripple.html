<link rel=import href="../polymer/polymer.html"><polymer-element name=paper-ripple attributes="initialOpacity opacityDecayVelocity"><template><style>:host{display:block;position:relative;border-radius:inherit;overflow:hidden}:host-context([noink]){pointer-events:none}#bg,#waves,.wave-container,.wave{pointer-events:none;position:absolute;top:0;left:0;width:100%;height:100%}#bg,.wave{opacity:0}#waves,.wave{overflow:hidden}.wave-container,.wave{border-radius:50%}:host(.circle) #bg,:host(.circle) #waves{border-radius:50%}:host(.circle) .wave-container{overflow:hidden}</style><div id=bg></div><div id=waves></div></template><script>(function(){var l=150;function n(y,w,t){var u=y/1000;var o=w/1000;var q=u+o;var v=t.width,r=t.height;var p=Math.min(Math.sqrt(v*v+r*r),l)*1.1+5;var s=1.1-0.2*(p/l);var x=(q/s);var z=p*(1-Math.pow(80,-x));return Math.abs(z)}function m(t,p,r){var q=t/1000;var o=p/1000;var s=q+o;if(p<=0){return r.initialOpacity}return Math.max(0,r.initialOpacity-o*r.opacityDecayVelocity)}function j(u,q,t){var s=u/1000;var o=q/1000;var p=s*0.3;var r=m(u,q,t);return Math.max(0,Math.min(p,r))}function k(q,o,r){var p=m(q.tDown,q.tUp,r);return p<0.01&&o>=Math.min(q.maxRadius,l)}function c(q,o,r){var p=m(q.tDown,q.tUp,r);return p>=r.initialOpacity&&o>=Math.min(q.maxRadius,l)}function g(v,r,q,p,t,o){if(o!==undefined){v.bg.style.opacity=o}v.wave.style.opacity=t;var w=p/(v.containerSize/2);var z=r-(v.containerWidth/2);var u=q-(v.containerHeight/2);v.wc.style.webkitTransform="translate3d("+z+"px,"+u+"px,0)";v.wc.style.transform="translate3d("+z+"px,"+u+"px,0)";v.wave.style.webkitTransform="scale("+w+","+w+")";v.wave.style.transform="scale3d("+w+","+w+",1)"}function b(s){var t=window.getComputedStyle(s);var u=t.color;var p=document.createElement("div");p.style.backgroundColor=u;p.classList.add("wave");var q=document.createElement("div");q.classList.add("wave-container");q.appendChild(p);var o=s.$.waves;o.appendChild(q);s.$.bg.style.backgroundColor=u;var r={bg:s.$.bg,wc:q,wave:p,waveColor:u,maxRadius:0,isMouseDown:false,mouseDownStart:0,mouseUpStart:0,tDown:0,tUp:0};return r}function e(p,o){if(p.waves){var q=p.waves.indexOf(o);p.waves.splice(q,1);o.wc.remove()}}var f=Math.pow;var a=Date.now;if(window.performance&&performance.now){a=performance.now.bind(performance)}function d(o,q){var p=o.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(typeof q=="undefined"){q=1}if(!p){return"rgba(255, 255, 255, "+q+")"}return"rgba("+p[1]+", "+p[2]+", "+p[3]+", "+q+")"}function h(p,o){return Math.sqrt(f(p.x-o.x,2)+f(p.y-o.y,2))}function i(p,s){var r=h(p,{x:0,y:0});var o=h(p,{x:s.w,y:0});var q=h(p,{x:0,y:s.h});var t=h(p,{x:s.w,y:s.h});return Math.max(r,o,q,t)}Polymer("paper-ripple",{initialOpacity:0.25,opacityDecayVelocity:0.8,backgroundFill:true,pixelDensity:2,eventDelegates:{down:"downAction",up:"upAction"},ready:function(){this.waves=[]},downAction:function(u){var s=b(this);this.cancelled=false;s.isMouseDown=true;s.tDown=0;s.tUp=0;s.mouseUpStart=0;s.mouseDownStart=a();var t=this.getBoundingClientRect();var r=t.width;var p=t.height;var q=u.x-t.left;var o=u.y-t.top;s.startPosition={x:q,y:o};if(this.classList.contains("recenteringTouch")){s.endPosition={x:r/2,y:p/2};s.slideDistance=h(s.startPosition,s.endPosition)}s.containerSize=Math.max(r,p);s.containerWidth=r;s.containerHeight=p;s.maxRadius=i(s.startPosition,{w:r,h:p});s.wc.style.top=(s.containerHeight-s.containerSize)/2+"px";s.wc.style.left=(s.containerWidth-s.containerSize)/2+"px";s.wc.style.width=s.containerSize+"px";s.wc.style.height=s.containerSize+"px";this.waves.push(s);if(!this._loop){this._loop=this.animate.bind(this,{width:r,height:p});requestAnimationFrame(this._loop)}},upAction:function(){for(var o=0;o<this.waves.length;o++){var p=this.waves[o];if(p.isMouseDown){p.isMouseDown=false;p.mouseUpStart=a();p.mouseDownStart=0;p.tUp=0;break}}this._loop&&requestAnimationFrame(this._loop)},cancel:function(){this.cancelled=true},animate:function(E){var D=false;var M=[];var B=0;var C=0;var q=null;var G={initialOpacity:this.initialOpacity,opacityDecayVelocity:this.opacityDecayVelocity,height:E.height,width:E.width};for(var I=0;I<this.waves.length;I++){var s=this.waves[I];if(s.mouseDownStart>0){s.tDown=a()-s.mouseDownStart}if(s.mouseUpStart>0){s.tUp=a()-s.mouseUpStart}var F=s.tUp;var p=s.tDown;B=Math.max(B,p);C=Math.max(C,F);var o=n(p,F,G);var t=m(p,F,G);var J=d(s.waveColor,t);q=s.waveColor;var z=s.startPosition.x;var v=s.startPosition.y;if(s.endPosition){var L=Math.min(1,o/s.containerSize*2/Math.sqrt(2));z+=L*(s.endPosition.x-s.startPosition.x);v+=L*(s.endPosition.y-s.startPosition.y)}var u=null;if(this.backgroundFill){var K=j(p,F,G);u=d(s.waveColor,K)}g(s,z,v,o,t,K);var A=c(s,o,G);var H=k(s,o,G);var r=!H||A;var w=s.mouseUpStart?!H:!A;D=D||w;if(!r||this.cancelled){M.push(s)}}if(D){requestAnimationFrame(this._loop)}for(var I=0;I<M.length;++I){var s=M[I];e(this,s)}if(!this.waves.length&&this._loop){this.$.bg.style.backgroundColor=null;this._loop=null;this.fire("core-transitionend")}}})})();</script></polymer-element>