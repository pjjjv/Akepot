suite("group-player",function(){function e(){return new AnimationGroup([new Animation(document.body,[],2e3),new Animation(document.body,[],1e3),new Animation(document.body,[],3e3)])}function t(){return new AnimationSequence([new Animation(document.body,[],2e3),new Animation(document.body,[],1e3),new Animation(document.body,[],3e3)])}function n(e,t,n,a){a=a?a+" ":"",i(e,t,0,a+"top player"),i(e,n,0,a+"inner player")}function i(e,t,n,a){return assert.isDefined(e,a+" exists"),0==t.length?void assert.equal(e._childPlayers.length,n,a+" no remaining players"):void(null===t[0]||"number"==typeof t[0]?(assert.equal(e.startTime,t[0],a+" startTime"),assert.equal(e.currentTime,t[1],a+" currentTime")):(i(e._childPlayers[n],t[0],0,a+" "+n),i(e,t.slice(1),n+1,a)))}setup(function(){document.timeline._players=[],webAnimationsMinifill.timeline._players=[],this.elements=[];var e=function(e){return new Animation(e,[{marginLeft:"0px"},{marginLeft:"100px"}],500)},t=function(e){return new Animation(e,[{backgroundColor:"black"},{backgroundColor:"white"}],500)},n=function(){return new AnimationSequence},i=function(){return new AnimationGroup},a=function(n){return new AnimationSequence([e(n),t(n)])},l=function(n){return new AnimationGroup([e(n),t(n)])},u=n(),s=document.createElement("div"),r=a(s),c=document.createElement("div");this.elements.push(c);var o=new AnimationSequence([e(c),t(c),a(c)]),m=document.createElement("div");this.elements.push(m);var p=new AnimationSequence([e(m),t(m),l(m)]),h=new AnimationSequence([i()]),d=new AnimationSequence([n()]),y=i(),g=document.createElement("div"),q=l(g),k=document.createElement("div");this.elements.push(k);var S=new AnimationGroup([e(k),t(k),a(k)]),f=document.createElement("div");this.elements.push(f);var x=new AnimationGroup([e(f),t(f),l(f)]),A=new AnimationGroup([i()]),_=new AnimationGroup([n()]);this.seqEmpty_source=u,this.seqSimple_source=r,this.seqWithSeq_source=o,this.seqWithGroup_source=p,this.seqWithEmptyGroup_source=h,this.seqWithEmptySeq_source=d,this.groupEmpty_source=y,this.groupSimple_source=q,this.groupWithSeq_source=S,this.groupWithGroup_source=x,this.groupWithEmptyGroup_source=A,this.groupWithEmptySeq_source=_,this.staticAnimation=function(e,t,n){var i=new Animation(e,[{marginLeft:t},{marginLeft:t}],n);return i.testValue=t,i},this.complexTarget=document.createElement("div"),this.elements.push(this.complexTarget),this.complexSource=new AnimationGroup([this.staticAnimation(this.complexTarget,"4px",5),new AnimationSequence([this.staticAnimation(this.complexTarget,"1px",2),new AnimationGroup([this.staticAnimation(this.complexTarget,"3px",2),this.staticAnimation(this.complexTarget,"2px",1)])]),this.staticAnimation(this.complexTarget,"0px",1)]),this.target=document.createElement("div"),this.elements.push(this.target);for(var w=0;w<this.elements.length;w++)document.documentElement.appendChild(this.elements[w])}),teardown(function(){for(var e=0;e<this.elements.length;e++)this.elements[e].parent&&this.elements[e].parent.removeChild(this.elements[e])}),test("playing an animationGroup works as expected",function(){tick(90);var t=document.timeline.play(e());n(t,[null,0],[]),tick(100),n(t,[100,0],[[100,0],[100,0],[100,0]]),tick(300),n(t,[100,200],[[100,200],[100,200],[100,200]]),tick(1200),n(t,[100,1100],[[100,1100],[100,1e3],[100,1100]]),tick(2200),n(t,[100,2100],[[100,2e3],[100,1e3],[100,2100]]),tick(3200),n(t,[100,3e3],[[100,2e3],[100,1e3],[100,3e3]])}),test("can seek an animationGroup",function(){tick(90);var t=document.timeline.play(e());tick(100),n(t,[100,0],[[100,0],[100,0],[100,0]]),t.currentTime=200,n(t,[-100,200],[[-100,200],[-100,200],[-100,200]]),t.currentTime=1100,n(t,[-1e3,1100],[[-1e3,1100],[-1e3,1100],[-1e3,1100]]),t.currentTime=2100,n(t,[-2e3,2100],[[-2e3,2100],[-2e3,2100],[-2e3,2100]]),t.currentTime=3100,n(t,[-3e3,3100],[[-3e3,3100],[-3e3,3100],[-3e3,3100]])}),test("can startTime seek an animationGroup",function(){tick(90);var t=document.timeline.play(e());tick(100),n(t,[100,0],[[100,0],[100,0],[100,0]]),t.startTime=-100,n(t,[-100,200],[[-100,200],[-100,200],[-100,200]]),t.startTime=-1e3,n(t,[-1e3,1100],[[-1e3,1100],[-1e3,1e3],[-1e3,1100]]),t.startTime=-2e3,n(t,[-2e3,2100],[[-2e3,2e3],[-2e3,1e3],[-2e3,2100]]),t.startTime=-3e3,n(t,[-3e3,3e3],[[-3e3,2e3],[-3e3,1e3],[-3e3,3e3]])}),test("playing an animationSequence works as expected",function(){tick(100);var e=document.timeline.play(t());tick(110),n(e,[110,0],[[110,0],[2110,-2e3],[3110,-3e3]]),tick(210),n(e,[110,100],[[110,100],[2110,-1900],[3110,-2900]]),tick(2210),n(e,[110,2100],[[110,2e3],[2110,100],[3110,-900]]),tick(3210),n(e,[110,3100],[[110,2e3],[2110,1e3],[3110,100]]),tick(6210),n(e,[110,6e3],[[110,2e3],[2110,1e3],[3110,3e3]])}),test("can seek an animationSequence",function(){tick(100);var e=document.timeline.play(t());tick(110),n(e,[110,0],[[110,0],[2110,-2e3],[3110,-3e3]]),e.currentTime=100,n(e,[10,100],[[10,100],[2010,-1900],[3010,-2900]]),e.currentTime=2100,n(e,[-1990,2100],[[-1990,2100],[10,100],[1010,-900]]),e.currentTime=3100,n(e,[-2990,3100],[[-2990,3100],[-990,1100],[10,100]]),e.currentTime=6100,n(e,[-5990,6100],[[-5990,6100],[-3990,4100],[-2990,3100]])}),test("can startTime seek an animationSequence",function(){tick(100);var e=document.timeline.play(t());tick(110),n(e,[110,0],[[110,0],[2110,-2e3],[3110,-3e3]]),e.startTime=10,n(e,[10,100],[[10,100],[2010,-1900],[3010,-2900]]),e.startTime=-1990,n(e,[-1990,2100],[[-1990,2e3],[10,100],[1010,-900]]),e.startTime=-2990,n(e,[-2990,3100],[[-2990,2e3],[-990,1e3],[10,100]]),e.startTime=-5990,n(e,[-5990,6e3],[[-5990,2e3],[-3990,1e3],[-2990,3e3]])}),test("complex animation tree timing while playing",function(){tick(90);var e=document.timeline.play(this.complexSource);tick(100),n(e,[100,0],[[100,0],[[100,0],[[102,-2],[102,-2]]],[100,0]],"t = 100"),tick(101),n(e,[100,1],[[100,1],[[100,1],[[102,-1],[102,-1]]],[100,1]],"t = 101"),tick(102),n(e,[100,2],[[100,2],[[100,2],[[102,0],[102,0]]],[100,1]],"t = 102")}),test("effects apply in the correct order",function(){tick(0);var e=document.timeline.play(this.complexSource);e.currentTime=0,assert.equal(getComputedStyle(this.complexTarget).marginLeft,"0px"),e.currentTime=1,n(e,[-1,1],[[-1,1,0],[[-1,1,0],[[1,-1,0],[1,-1,0]]],[-1,1,0]]),assert.equal(getComputedStyle(this.complexTarget).marginLeft,"1px"),e.currentTime=2,n(e,[-2,2],[[-2,2,0],[[-2,2,0],[[0,0,0],[0,0,0]]],[-2,2,0]]),assert.equal(getComputedStyle(this.complexTarget).marginLeft,"2px"),e.currentTime=3,assert.equal(getComputedStyle(this.complexTarget).marginLeft,"3px"),e.currentTime=4,assert.equal(getComputedStyle(this.complexTarget).marginLeft,"4px"),e.currentTime=5,assert.equal(getComputedStyle(this.complexTarget).marginLeft,"0px")}),test("cancelling group players",function(){tick(0);var e=document.timeline.play(this.complexSource);tick(1),tick(4),assert.equal(getComputedStyle(this.complexTarget).marginLeft,"3px"),e.cancel(),assert.equal(e.currentTime,null),assert.equal(getComputedStyle(this.complexTarget).marginLeft,"0px")}),test("redundant animation node wrapping",function(){tick(100);var e=new AnimationSequence([this.staticAnimation(this.target,"0px",1),new AnimationGroup([new AnimationSequence([this.staticAnimation(this.target,"1px",1),this.staticAnimation(this.target,"2px",1)])])]),t=document.timeline.play(e);assert.equal(getComputedStyle(this.target).marginLeft,"0px"),n(t,[100,0],[[100,0,0,0],[[[101,-1,0,1],[102,-2,1,2]]]],"t = 100"),tick(101),assert.equal(getComputedStyle(this.target).marginLeft,"1px"),n(t,[100,1],[[100,1,0,0],[[[101,0,0,1],[102,-1,1,2]]]],"t = 101"),tick(102),assert.equal(getComputedStyle(this.target).marginLeft,"2px"),assert.equal(document.timeline.currentTime,102),n(t,[100,2],[[100,1,0,0],[[[101,1,0,1],[102,0,1,2]]]],"t = 102"),tick(103),assert.equal(getComputedStyle(this.target).marginLeft,"0px"),n(t,[100,3],[[100,1,0,0],[[[101,1,0,1],[102,1,1,2]]]],"t = 103"),this.target.parent&&this.target.parent.removeChild(target)}),test("delays on groups work correctly",function(){var e=new AnimationGroup([new AnimationGroup([this.staticAnimation(this.target,"4px",{duration:3,delay:1}),this.staticAnimation(this.target,"1px",{duration:1,delay:0})],{delay:1}),new AnimationSequence([this.staticAnimation(this.target,"0px",{duration:1,delay:0}),this.staticAnimation(this.target,"3px",{duration:2,delay:1}),this.staticAnimation(this.target,"2px",{duration:1,delay:-2})])]),t=document.timeline.play(e);tick(100),n(t,[100,0],[[[101,-1],[101,-1]],[[100,0],[101,-1],[104,-4]]]),assert.equal(getComputedStyle(this.target).marginLeft,"0px"),tick(101),assert.equal(getComputedStyle(this.target).marginLeft,"1px"),tick(102),assert.equal(getComputedStyle(this.target).marginLeft,"2px"),tick(103),assert.equal(getComputedStyle(this.target).marginLeft,"3px"),tick(104),assert.equal(getComputedStyle(this.target).marginLeft,"4px"),tick(105),assert.equal(getComputedStyle(this.target).marginLeft,"0px")}),test("end delays on groups work correctly",function(){var e=new AnimationSequence([new AnimationSequence([this.staticAnimation(this.target,"1px",{duration:2,endDelay:2}),this.staticAnimation(this.target,"4px",{duration:1,endDelay:1})],{endDelay:-6}),new AnimationSequence([this.staticAnimation(this.target,"0px",{duration:1,endDelay:1}),this.staticAnimation(this.target,"3px",{duration:2,endDelay:-2}),this.staticAnimation(this.target,"2px",{duration:1,endDelay:2})])]),t=document.timeline.play(e);tick(100),n(t,[100,0],[[[100,0],[104,-4]],[[100,0],[102,-2],[102,-2]]]),assert.equal(getComputedStyle(this.target).marginLeft,"0px"),tick(101),assert.equal(getComputedStyle(this.target).marginLeft,"1px"),tick(102),assert.equal(getComputedStyle(this.target).marginLeft,"2px"),tick(103),assert.equal(getComputedStyle(this.target).marginLeft,"3px"),tick(104)}),test("sources are working for basic operations",function(){var e=[];e.push(document.timeline.play(this.seqEmpty_source)),e.push(document.timeline.play(this.seqSimple_source)),e.push(document.timeline.play(this.seqWithSeq_source)),e.push(document.timeline.play(this.seqWithGroup_source)),e.push(document.timeline.play(this.seqWithEmptyGroup_source)),e.push(document.timeline.play(this.seqWithEmptySeq_source)),e.push(document.timeline.play(this.groupEmpty_source)),e.push(document.timeline.play(this.groupSimple_source)),e.push(document.timeline.play(this.groupWithSeq_source)),e.push(document.timeline.play(this.groupWithGroup_source)),e.push(document.timeline.play(this.groupWithEmptyGroup_source)),e.push(document.timeline.play(this.groupWithEmptySeq_source));var t=e.length;tick(50);for(var n=0;t>n;n++)e[n].pause();tick(100);for(var n=0;t>n;n++)e[n].play();tick(200);for(var n=0;t>n;n++)e[n].currentTime+=1;tick(300);for(var n=0;t>n;n++)e[n].startTime+=1;tick(350);for(var n=0;t>n;n++)e[n].reverse();tick(400);for(var n=0;t>n;n++)e[n].finish();tick(500),tick(600);for(var n=0;t>n;n++)e[n].cancel();for(var n=0;t>n;n++)e[n].play()}),test("pausing works as expected with an empty AnimationSequence",function(){var e=document.timeline.play(this.seqEmpty_source);tick(0),assert.equal(e.startTime,0),assert.equal(e.currentTime,0),e.pause(),assert.equal(e.startTime,null),assert.equal(e.currentTime,0)}),test("pausing works as expected with a simple AnimationSequence",function(){var e=document.timeline.play(this.seqSimple_source);tick(0),n(e,[0,0],[[0,0],[500,-500]],"t = 0"),tick(200),n(e,[0,200],[[0,200],[500,-300]],"t = 200"),e.pause(),n(e,[null,null],[[null,null],[null,null]],"t = 200"),tick(300),n(e,[null,200],[[null,200],[null,-300]],"t = 300"),e.play(),n(e,[null,200],[[null,200],[null,-300]],"t = 300"),tick(301),n(e,[101,200],[[101,200],[601,-300]],"t = 301"),tick(700),n(e,[101,599],[[101,500],[601,99]],"t = 700")}),test("pausing works as expected with an AnimationSequence inside an AnimationSequence",function(){var e=document.timeline.play(this.seqWithSeq_source);tick(0),n(e,[0,0],[[0,0],[500,-500],[[1e3,-1e3],[1500,-1500]]],"t = 0"),tick(200),n(e,[0,200],[[0,200],[500,-300],[[1e3,-800],[1500,-1300]]],"t = 200"),e.pause(),n(e,[null,null],[[null,null],[null,null],[[null,null],[null,null]]],"t = 200"),tick(300),n(e,[null,200],[[null,200],[null,-300],[[null,-800],[null,-1300]]],"t = 300"),e.play(),tick(310),n(e,[110,200],[[110,200],[610,-300],[[1110,-800],[1610,-1300]]],"t = 310"),tick(1300),n(e,[110,1190],[[110,500],[610,500],[[1110,190],[1610,-310]]],"t = 1300"),e.pause(),n(e,[null,null],[[null,500],[null,500],[[null,null],[null,null]]],"t = 1300"),tick(1400),n(e,[null,1190],[[null,500],[null,500],[[null,190],[null,-310]]],"t = 1400"),e.play(),n(e,[null,1190],[[null,500],[null,500],[[null,190],[null,-310]]],"t = 1400"),tick(1410),n(e,[220,1190],[[220,500],[720,500],[[1220,190],[1720,-310]]],"t = 1410"),tick(1600),n(e,[220,1380],[[220,500],[720,500],[[1220,380],[1720,-120]]],"t = 1600"),e.pause(),n(e,[null,null],[[null,500],[null,500],[[null,null],[null,null]]],"t = 1600"),tick(1700),n(e,[null,1380],[[null,500],[null,500],[[null,380],[null,-120]]],"t = 1700"),e.play(),tick(1710),n(e,[330,1380],[[330,500],[830,500],[[1330,380],[1830,-120]]],"t = 1710"),tick(2400),n(e,[330,2e3],[[330,500],[830,500],[[1330,500],[1830,500]]],"t = 2400")}),test("pausing works as expected with an AnimationGroup inside an AnimationSequence",function(){var e=document.timeline.play(this.seqWithGroup_source);tick(0),n(e,[0,0],[[0,0],[500,-500],[[1e3,-1e3],[1e3,-1e3]]],"t = 0"),tick(200),n(e,[0,200],[[0,200],[500,-300],[[1e3,-800],[1e3,-800]]],"t = 200"),e.pause(),n(e,[null,null],[[null,null],[null,null],[[null,null],[null,null]]],"t = 200"),tick(300),n(e,[null,200],[[null,200],[null,-300],[[null,-800],[null,-800]]],"t = 300"),e.play(),tick(310),n(e,[110,200],[[110,200],[610,-300],[[1110,-800],[1110,-800]]],"t = 310"),tick(1310),n(e,[110,1200],[[110,500],[610,500],[[1110,200],[1110,200]]],"t = 1310"),e.pause(),n(e,[null,null],[[null,500],[null,500],[[null,null],[null,null]]],"t = 1310"),tick(1400),n(e,[null,1200],[[null,500],[null,500],[[null,200],[null,200]]],"t = 1410"),e.play(),tick(1410),n(e,[210,1200],[[210,500],[710,500],[[1210,200],[1210,200]]],"t = 1410"),tick(1610),n(e,[210,1400],[[210,500],[710,500],[[1210,400],[1210,400]]],"t = 1610"),e.pause(),tick(1810),n(e,[null,1400],[[null,500],[null,500],[[null,400],[null,400]]],"t = 1810"),e.play(),tick(1820),n(e,[420,1400],[[420,500],[920,500],[[1420,400],[1420,400]]],"t = 1820"),tick(2020),n(e,[420,1500],[[420,500],[920,500],[[1420,500],[1420,500]]],"t = 2020"),e.pause(),n(e,[null,1500],[[null,500],[null,500],[[null,500],[null,500]]],"t = 2020")}),test("pausing works as expected with an empty AnimationSequence inside an AnimationSequence",function(){var e=document.timeline.play(this.seqWithEmptySeq_source);tick(0),n(e,[0,0],[0,0],"t = 0"),e.pause(),n(e,[null,0],[null,0],"t = 0 after pause")}),test("pausing works as expected with an empty AnimationGroup inside an AnimationSequence",function(){var e=document.timeline.play(this.seqWithEmptyGroup_source);tick(0),n(e,[0,0],[0,0],"t = 0"),e.pause(),n(e,[null,0],[null,0],"t = 0 after pause")}),test("playState works for groups",function(){var e=document.createElement("div");document.body.appendChild(e);var t=new AnimationSequence([new Animation(e,[],100),new Animation(e,[],100)]),n=document.timeline.play(t);assert.equal(n.playState,"pending"),tick(1),assert.equal(n.playState,"running"),assert.equal(n._childPlayers[0]._player.playState,"running"),assert.equal(n._childPlayers[1]._player.playState,"running"),tick(101),assert.equal(n.playState,"running"),assert.equal(n._childPlayers[0]._player.playState,"finished"),assert.equal(n._childPlayers[1]._player.playState,"running"),n.pause(),assert.equal(n.playState,"pending"),assert.equal(n._childPlayers[0]._player.playState,"paused"),assert.equal(n._childPlayers[1]._player.playState,"pending"),tick(102),assert.equal(n.playState,"paused"),assert.equal(n._childPlayers[0]._player.playState,"paused"),assert.equal(n._childPlayers[1]._player.playState,"paused"),n.play(),assert.equal(n.playState,"pending"),assert.equal(n._childPlayers[0]._player.playState,"pending"),assert.equal(n._childPlayers[1]._player.playState,"pending"),tick(103),assert.equal(n.playState,"running"),assert.equal(n._childPlayers[0]._player.playState,"finished"),assert.equal(n._childPlayers[1]._player.playState,"running"),tick(204),assert.equal(n.playState,"finished"),assert.equal(n._childPlayers[0]._player.playState,"finished"),assert.equal(n._childPlayers[1]._player.playState,"finished")})});